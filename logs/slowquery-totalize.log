
# 28s user time, 30ms system time, 31.25M rss, 39.26M vsz
# Current date: Sat Jun 11 09:16:42 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 494.08k total, 38 unique, 4.12k QPS, 3.18x concurrency ________
# Time range: 2022-06-11T09:14:40 to 2022-06-11T09:16:40
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           381s     1us      7s   771us     2ms    12ms   113us
# Lock time             3s       0    82ms     5us     1us   224us     1us
# Rows sent          2.03M       0 252.72k    4.32    0.99  357.61    0.99
# Rows examine      48.51M       0  19.77M  102.96    0.99  28.76k    0.99
# Query size        52.03M       6   1.80k  110.42  158.58  130.13  102.22

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0xA6F5EBC08FC0B14AC6764BC... 79.0978 20.7%   2270 0.0348  0.03 SELECT playlist user playlist_song
#    2 0xD3D79AC2E339745D16FD77E... 75.3716 19.8% 213991 0.0004  0.01 SELECT playlist_favorite
#    3 0xEF4E32253D50FC6205E21CE... 68.1483 17.9% 110441 0.0006  0.01 SELECT playlist
#    4 0x0C7853719E9897E59B57F2A... 40.2397 10.6%  17301 0.0023  0.01 SELECT playlist_song song artist
#    5 0xFE201CF788CDAF0ED135116... 31.3162  8.2%  72338 0.0004  0.01 SELECT user
#    6 0x740EF2FBF5412A2DE51CEA9... 18.6683  4.9%   2473 0.0075  0.02 SELECT playlist user
#    7 0xA1D549827369435D2D6B8F3... 14.3406  3.8%   1019 0.0141  0.03 SELECT playlist_favorite playlist user
#    8 0x3B7F9C3BFD4303564EFFC05... 11.2063  2.9%  13433 0.0008  0.01 INSERT playlist_favorite
#    9 0xE4CA4C0AA0D305F63D77C03...  9.0875  2.4%  21963 0.0004  0.01 SELECT sessions_golang
#   10 0x0A24D4A57D22B71F538F1AE...  7.0372  1.8%  13222 0.0005  0.01 SELECT song
#   11 0xBB803527F0B05ED37FAF2BB...  6.6540  1.7%      1 6.6540  0.00 DELETE SELECT playlist_song playlist
#   12 0x9FEFFEE564795B4341138AC...  5.8364  1.5%  13630 0.0004  0.01 SELECT playlist_favorite
# MISC 0xMISC                       14.2885  3.7%  11998 0.0012   0.0 <26 ITEMS>

# Query 1: 33.38 QPS, 1.16x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 56925651
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.03
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2270
# Exec time     20     79s     3ms   235ms    35ms    95ms    30ms    24ms
# Lock time      0    11ms     1us     5ms     4us     2us   103us     1us
# Rows sent     21 445.58k     201     201     201     201       0     201
# Rows examine  40  19.73M   8.90k   8.90k   8.90k   8.90k       0   8.90k
# Query size     7   4.00M   1.80k   1.80k   1.80k   1.80k       0   1.80k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ###########
#  10ms  ################################################################
# 100ms  ####
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (115815, 153021, 70348, 133021, 44, 329941, 281490, 271490, 233434, 20044, 10044, 80348, 300914, 217804, 90348, 207804, 180624, 170624, 339941, 310914/*... omitted 181 items ...*/) GROUP BY p.id\G

# Query 2: 3.15k QPS, 1.11x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 133434491
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         43  213991
# Exec time     19     75s    40us   121ms   352us     1ms     1ms    93us
# Lock time     29   802ms       0    24ms     3us     1us   109us     1us
# Rows sent     10 208.98k       1       1       1       1       0       1
# Rows examine   0  13.86k       0       1    0.07    0.99    0.25       0
# Query size    45  23.68M     103     134  116.02  124.25    6.36  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ##############################################
#   1ms  ######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'thosecivilstation' AND playlist_id = 88861\G

# Query 3: 1.62k QPS, 1.00x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 99761988
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         22  110441
# Exec time     17     68s    73us    93ms   617us     2ms     2ms   138us
# Lock time     17   476ms       0    12ms     4us     1us   106us     1us
# Rows sent      5 107.85k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0 107.85k       0       1    1.00    0.99    0.00    0.99
# Query size    13   6.95M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01FPB711Z8W6J5VPAR80J08M32'\G

# Query 4: 254.43 QPS, 0.59x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 142155899
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   17301
# Exec time     10     40s   112us   202ms     2ms    10ms     6ms   596us
# Lock time      4   122ms     1us    10ms     7us     2us   140us     1us
# Rows sent     32 669.12k       0      79   39.60   72.65   22.98   38.53
# Rows examine   4   1.96M       0     237  118.81  223.14   68.96  112.70
# Query size     9   4.70M     281     285  284.87  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ###############################
#  10ms  #####
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 201088\G

# Query 5: 1.06k QPS, 0.46x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 154512220
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         14   72338
# Exec time      8     31s    49us    69ms   432us     2ms     2ms    98us
# Lock time     13   366ms       0    34ms     5us     1us   192us     1us
# Rows sent      3  70.64k       1       1       1       1       0       1
# Rows examine   0  70.64k       1       1       1       1       0       1
# Query size     7   3.82M      46      70   55.44   59.77    3.76   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ########################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'sonvaluespecial'\G

# Query 6: 36.37 QPS, 0.27x concurrency, ID 0x740EF2FBF5412A2DE51CEA9BD27430E7 at byte 156861897
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2473
# Exec time      4     19s   571us   133ms     8ms    30ms    11ms     3ms
# Lock time      0     7ms     1us     1ms     2us     1us    25us     1us
# Rows sent     11 241.50k     100     100     100     100       0     100
# Rows examine   0 488.01k     200     214  202.07  202.40    4.23  192.76
# Query size     1 1004.66k     416     416     416     416       0     416
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #####
#   1ms  ################################################################
#  10ms  ###################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (idx_is_public_created_at_desc) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.created_at DESC LIMIT 100\G

# Query 7: 14.99 QPS, 0.21x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 86999844
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.03
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1019
# Exec time      3     14s   215us   159ms    14ms    51ms    20ms     7ms
# Lock time      0     3ms       0   907us     3us     1us    29us     1us
# Rows sent      2  44.64k       0      89   44.86   54.21    7.94   44.60
# Rows examine   0 269.62k       0     535  270.95  329.68   42.37  258.32
# Query size     0 479.31k     472     496  481.66  487.09    5.42  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  #####################################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'ourgenerationspring' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 8: 197.54 QPS, 0.16x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 142127596
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   13433
# Exec time      2     11s    65us    74ms   834us     3ms     3ms   125us
# Lock time      2    75ms       0    23ms     5us     1us   238us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3   1.97M     144     168  153.49  158.58    4.35  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (363656, 'electioninstitutionowner', '2022-06-11 09:15:57.810608896')\G

# Query 9: 322.99 QPS, 0.13x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 154513986
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   21963
# Exec time      2      9s    42us    66ms   413us     1ms     2ms    80us
# Lock time      2    79ms       0     5ms     3us     1us    71us     1us
# Rows sent      1  21.45k       1       1       1       1       0       1
# Rows examine   0  21.45k       1       1       1       1       0       1
# Query size     4   2.14M     102     102     102     102       0     102
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #########################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '13161'\G

# Query 10: 194.44 QPS, 0.10x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 146802661
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   13222
# Exec time      1      7s    75us    54ms   532us     2ms     2ms   131us
# Lock time      2    76ms       0    10ms     5us     1us   135us     1us
# Rows sent      0  12.91k       1       1       1       1       0       1
# Rows examine   0  12.91k       1       1       1       1       0       1
# Query size     1 800.55k      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y8750XABHYXEWNFHCWEY0C'\G

# Query 11: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2342
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-11T09:14:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  40  19.77M  19.77M  19.77M  19.77M  19.77M       0  19.77M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G

# Query 12: 200.44 QPS, 0.09x concurrency, ID 0x9FEFFEE564795B4341138ACE04ABE55B at byte 159813970
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T09:14:57 to 2022-06-11T09:16:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   13630
# Exec time      1      6s    51us    90ms   428us     1ms     2ms    93us
# Lock time      3   106ms       0    20ms     7us     1us   237us     1us
# Rows sent      0     196       0       1    0.01       0    0.12       0
# Rows examine   0     196       0       1    0.01       0    0.12       0
# Query size     2   1.42M     100     124  109.60  112.70    3.95  107.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ######################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist_favorite WHERE `playlist_id` = 310914 AND `favorite_user_account` = 'hearverymany'\G
