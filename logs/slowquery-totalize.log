
# 30.5s user time, 50ms system time, 31.35M rss, 39.26M vsz
# Current date: Thu Jun  9 12:16:45 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 543.19k total, 38 unique, 4.56k QPS, 5.46x concurrency ________
# Time range: 2022-06-09T12:14:26 to 2022-06-09T12:16:25
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           650s     1us      8s     1ms     2ms    23ms   113us
# Lock time             2s       0    48ms     3us     1us   107us     1us
# Rows sent          2.22M       0 252.75k    4.28    0.99  341.42    0.99
# Rows examine     170.25M       0  19.76M  328.66  118.34  28.18k    0.99
# Query size        51.72M       6   4.06k   99.83  271.23  168.18   69.19

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0xE8049327801D7D5A04CEB3D... 241.0276 37.1%    368 0.6550  0.21 SELECT playlist
#    2 0xA6F5EBC08FC0B14AC6764BC... 105.8938 16.3%    921 0.1150  0.05 SELECT playlist user playlist_song
#    3 0xEC063962A0903583D4BF22B...  76.7704 11.8% 145627 0.0005  0.01 SELECT playlist_favorite
#    4 0x0C7853719E9897E59B57F2A...  61.1680  9.4%  25300 0.0024  0.02 SELECT playlist_song song artist
#    5 0x8AFB70E4EF33ECB86281555...  43.5364  6.7% 120330 0.0004  0.00 SELECT playlist_song
#    6 0xD3D79AC2E339745D16FD77E...  37.0104  5.7% 118571 0.0003  0.00 SELECT playlist_favorite
#    7 0xEF4E32253D50FC6205E21CE...  24.7991  3.8%  50621 0.0005  0.01 SELECT playlist
#    8 0xFE201CF788CDAF0ED135116...  13.2222  2.0%  37169 0.0004  0.01 SELECT user
#    9 0x3B7F9C3BFD4303564EFFC05...   9.7909  1.5%  10364 0.0009  0.01 INSERT playlist_favorite
#   10 0xBB803527F0B05ED37FAF2BB...   7.5818  1.2%      1 7.5818  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                        28.8807  4.4%  33922 0.0009   0.0 <28 ITEMS>

# Query 1: 5.41 QPS, 3.54x concurrency, ID 0xE8049327801D7D5A04CEB3D9809DD3A2 at byte 146519692
# Scores: V/M = 0.21
# Time range: 2022-06-09T12:14:44 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     368
# Exec time     37    241s    74ms      2s   655ms      1s   374ms   580ms
# Lock time      0   569us       0   102us     1us     1us     5us     1us
# Rows sent      0   1.16k       0      30    3.23   14.52    5.10    0.99
# Rows examine  53  90.85M 252.75k 252.88k 252.81k 245.21k       0 245.21k
# Query size     0  35.09k      90     112   97.65   97.36    3.40   92.72
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms  #
# 100ms  ################################################################
#    1s  ###############
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist where user_account = 'seatelsewho' ORDER BY created_at DESC LIMIT 100\G

# Query 2: 13.35 QPS, 1.53x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 173542130
# Scores: V/M = 0.05
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     921
# Exec time     16    106s    10ms   583ms   115ms   253ms    74ms   100ms
# Lock time      0     2ms     1us   573us     2us     1us    18us     1us
# Rows sent     19 450.61k     501     501     501     501       0     501
# Rows examine  11  18.76M  20.85k  20.85k  20.85k  20.85k       0  20.85k
# Query size     7   3.65M   4.06k   4.06k   4.06k   4.06k       0   4.06k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms  ##########################################################
# 100ms  ################################################################
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (115815, 153021, 80348, 70348, 197804, 170624, 133021, 90348, 44, 339941, 329941, 310914, 30044, 281490, 271490, 253434, 233434, 20044, 180624, 10044/*... omitted 481 items ...*/) GROUP BY p.id\G

# Query 3: 2.11k QPS, 1.11x concurrency, ID 0xEC063962A0903583D4BF22B4F6620A35 at byte 173943960
# Scores: V/M = 0.01
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         26  145627
# Exec time     11     77s    56us   138ms   527us     2ms     2ms   113us
# Lock time     25   448ms       0    28ms     3us     1us    99us     1us
# Rows sent      6 142.21k       1       1       1       1       0       1
# Rows examine  16  27.58M       0  14.68k  198.56  755.64   1.12k   17.65
# Query size    19   9.91M      67      72   71.33   69.19    1.02   69.19
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where playlist_id = 90348\G

# Query 4: 366.67 QPS, 0.89x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 163770206
# Scores: V/M = 0.02
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   25300
# Exec time      9     61s   110us   141ms     2ms    11ms     6ms   541us
# Lock time      7   128ms       0    12ms     5us     1us   124us     1us
# Rows sent     42 970.38k       0      79   39.28   72.65   22.46   38.53
# Rows examine   1   2.84M       0     237  117.83  223.14   67.41  118.34
# Query size    13   6.87M     282     285  284.64  284.79    1.50  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ###########################
#  10ms  #####
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 360632\G

# Query 5: 1.77k QPS, 0.64x concurrency, ID 0x8AFB70E4EF33ECB862815558CB07356A at byte 130110828
# Scores: V/M = 0.00
# Time range: 2022-06-09T12:14:44 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         22  120330
# Exec time      6     44s    60us    63ms   361us     1ms     1ms   113us
# Lock time     26   461ms       0    48ms     3us     1us   162us     1us
# Rows sent      5 117.51k       1       1       1       1       0       1
# Rows examine   2   4.03M       0      79   35.09   72.65   24.52   34.95
# Query size    14   7.72M      63      68   67.26   65.89    1.06   65.89
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ############
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_song where playlist_id = 360578\G

# Query 6: 1.72k QPS, 0.54x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 162870217
# Scores: V/M = 0.00
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         21  118571
# Exec time      5     37s    45us    84ms   312us     1ms     1ms    89us
# Lock time     19   338ms       0    10ms     2us     1us    69us     1us
# Rows sent      5 115.79k       1       1       1       1       0       1
# Rows examine   0  22.94k       0       1    0.20    0.99    0.40       0
# Query size    25  13.26M     103     134  117.27  124.25    6.02  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ######################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'protecthighdescribe' AND playlist_id = 23001\G

# Query 7: 733.64 QPS, 0.36x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 151445317
# Scores: V/M = 0.01
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   50621
# Exec time      3     25s    74us    86ms   489us     2ms     2ms   131us
# Lock time      9   162ms       0    12ms     3us     1us    88us     1us
# Rows sent      2  49.43k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0  49.43k       0       1    1.00    0.99    0.00    0.99
# Query size     6   3.19M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01G54688ECQ8VHH2ENT76TA17B'\G

# Query 8: 538.68 QPS, 0.19x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 117052947
# Scores: V/M = 0.01
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   37169
# Exec time      2     13s    51us    66ms   355us     1ms     1ms    93us
# Lock time      5   104ms       0     5ms     2us     1us    48us     1us
# Rows sent      1  36.30k       1       1       1       1       0       1
# Rows examine   0  36.30k       1       1       1       1       0       1
# Query size     3   1.96M      46      70   55.42   59.77    3.76   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #####################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'serviceinterestnothing'\G

# Query 9: 150.20 QPS, 0.14x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 163761107
# Scores: V/M = 0.01
# Time range: 2022-06-09T12:14:43 to 2022-06-09T12:15:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1   10364
# Exec time      1     10s    67us    75ms   944us     4ms     3ms   131us
# Lock time      1    32ms       0    10ms     3us     1us    97us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     2   1.52M     144     168  153.47  158.58    4.55  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (360629, 'helpsimpleidentify', '2022-06-09 12:15:48.438308469')\G

# Query 10: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2342
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-09T12:14:38
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      8s      8s      8s      8s      8s       0      8s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  11  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
