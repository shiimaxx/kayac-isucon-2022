
# 37.3s user time, 60ms system time, 31.38M rss, 39.27M vsz
# Current date: Sat Jun 11 07:50:27 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 663.08k total, 38 unique, 3.68k QPS, 2.01x concurrency ________
# Time range: 2022-06-11T07:47:19 to 2022-06-11T07:50:19
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           362s     1us      7s   546us     2ms    10ms   108us
# Lock time             3s       0    58ms     3us     1us   152us     1us
# Rows sent          2.76M       0 252.74k    4.36   18.53  308.71    0.99
# Rows examine      50.31M       0  19.77M   79.56   76.28  24.83k    0.99
# Query size        65.70M       6   1.80k  103.89  284.79  102.56   65.89

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0x8AFB70E4EF33ECB86281555... 72.2011 19.9% 215380 0.0003  0.00 SELECT playlist_song
#    2 0x0C7853719E9897E59B57F2A... 64.0906 17.7%  38707 0.0017  0.01 SELECT playlist_song song artist
#    3 0xD3D79AC2E339745D16FD77E... 61.6628 17.0% 206529 0.0003  0.00 SELECT playlist_favorite
#    4 0xA6F5EBC08FC0B14AC6764BC... 45.8139 12.7%   1529 0.0300  0.02 SELECT playlist user playlist_song
#    5 0xEF4E32253D50FC6205E21CE... 36.6255 10.1%  77447 0.0005  0.01 SELECT playlist
#    6 0xFE201CF788CDAF0ED135116... 19.1763  5.3%  55015 0.0003  0.01 SELECT user
#    7 0xA1D549827369435D2D6B8F3... 11.6022  3.2%    935 0.0124  0.02 SELECT playlist_favorite playlist user
#    8 0x740EF2FBF5412A2DE51CEA9...  8.8323  2.4%   1721 0.0051  0.01 SELECT playlist user
#    9 0x3B7F9C3BFD4303564EFFC05...  8.3015  2.3%  12879 0.0006  0.01 INSERT playlist_favorite
#   10 0xBB803527F0B05ED37FAF2BB...  7.1643  2.0%      1 7.1643  0.00 DELETE SELECT playlist_song playlist
#   11 0xE4CA4C0AA0D305F63D77C03...  6.6366  1.8%  20531 0.0003  0.01 SELECT sessions_golang
#   12 0x0A24D4A57D22B71F538F1AE...  4.8701  1.3%  11346 0.0004  0.00 SELECT song
# MISC 0xMISC                       15.1059  4.2%  21061 0.0007   0.0 <26 ITEMS>

# Query 1: 3.17k QPS, 1.06x concurrency, ID 0x8AFB70E4EF33ECB862815558CB07356A at byte 213708621
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         32  215380
# Exec time     19     72s    57us   147ms   335us     1ms     1ms   113us
# Lock time     28   728ms       0    34ms     3us     1us   110us     1us
# Rows sent      7 210.33k       1       1       1       1       0       1
# Rows examine  12   6.14M       0      79   29.90   72.65   25.15   23.65
# Query size    20  13.76M      63      68   67.01   65.89    1.24   65.89
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##############
# 100us  ################################################################
#   1ms  ####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_song where playlist_id = 361632\G

# Query 2: 569.22 QPS, 0.94x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 208663058
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5   38707
# Exec time     17     64s    90us   151ms     2ms     7ms     4ms   445us
# Lock time      6   164ms       0     6ms     4us     1us    72us     1us
# Rows sent     52   1.45M       0      79   39.28   72.65   23.04   38.53
# Rows examine   8   4.35M       0     237  117.83  223.14   69.19  118.34
# Query size    16  10.52M     281     285  284.87  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####################
#  10ms  ##
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 361629\G

# Query 3: 3.04k QPS, 0.91x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 161678682
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         31  206529
# Exec time     17     62s    40us    84ms   298us   972us     1ms    89us
# Lock time     25   659ms       0    31ms     3us     1us   126us     1us
# Rows sent      7 201.69k       1       1       1       1       0       1
# Rows examine   0  34.41k       0       1    0.17    0.99    0.37       0
# Query size    35  23.04M     103     134  116.98  124.25    5.75  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ###################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'openclaimblue' AND playlist_id = 0\G

# Query 4: 22.49 QPS, 0.67x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 208576079
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1529
# Exec time     12     46s     3ms   250ms    30ms    82ms    27ms    21ms
# Lock time      0    10ms     1us     3ms     6us     1us   104us     1us
# Rows sent     10 300.06k     177     201  200.95  192.76    0.79  192.76
# Rows examine  26  13.26M   7.72k   8.89k   8.88k   8.89k   54.82   8.89k
# Query size     4   2.69M   1.80k   1.80k   1.80k   1.80k       0   1.80k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ###############
#  10ms  ################################################################
# 100ms  ###
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (90348, 143021, 180624, 170624, 217804, 30044, 243434, 339941, 310914, 300914, 233434, 207804, 253434, 105815, 80348, 197804, 115815, 153021, 70348, 133021/*... omitted 181 items ...*/) GROUP BY p.id\G

# Query 5: 1.14k QPS, 0.54x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 108291595
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         11   77447
# Exec time     10     37s    70us    63ms   472us     2ms     2ms   131us
# Lock time     10   261ms       0    13ms     3us     1us    90us     1us
# Rows sent      2  75.63k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0  75.63k       0       1    1.00    0.99    0.00    0.99
# Query size     7   4.87M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01G58VQZ3H83GE9GQMYCJAEWGD'\G

# Query 6: 809.04 QPS, 0.28x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 192406406
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   55015
# Exec time      5     19s    47us    78ms   348us     1ms     1ms    93us
# Lock time     10   261ms       0    14ms     4us     1us   123us     1us
# Rows sent      1  53.73k       1       1       1       1       0       1
# Rows examine   0  53.73k       1       1       1       1       0       1
# Query size     4   2.90M      47      70   55.37   59.77    3.72   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #########################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'growreachsuggest'\G

# Query 7: 13.75 QPS, 0.17x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 208328110
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     935
# Exec time      3     12s   219us   146ms    12ms    46ms    17ms     6ms
# Lock time      0    10ms     1us     7ms    10us     1us   218us     1us
# Rows sent      1  40.50k       0      83   44.36   54.21    7.39   42.48
# Rows examine   0 243.60k       0     501  266.79  313.99   38.29  258.32
# Query size     0 439.82k     474     496  481.68  487.09    5.22  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  #################################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'handhumandifference' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 8: 25.31 QPS, 0.13x concurrency, ID 0x740EF2FBF5412A2DE51CEA9BD27430E7 at byte 107444524
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1721
# Exec time      2      9s   533us    59ms     5ms    16ms     7ms     2ms
# Lock time      0     4ms       0   975us     2us     1us    24us     1us
# Rows sent      5 168.07k     100     100     100     100       0     100
# Rows examine   0 339.99k     200     214  202.29  202.40    4.36  192.76
# Query size     1 699.16k     416     416     416     416       0     416
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #########
#   1ms  ################################################################
#  10ms  ############
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (idx_is_public_created_at_desc) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.created_at DESC LIMIT 100\G

# Query 9: 189.40 QPS, 0.12x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 194230774
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1   12879
# Exec time      2      8s    56us    56ms   644us     2ms     2ms   113us
# Lock time      1    36ms       0     2ms     2us     1us    41us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     2   1.88M     143     168  153.23  158.58    4.67  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ####
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (361632, 'protecthighdescribe', '2022-06-11 07:48:38.865550448')\G

# Query 10: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2363
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-11T07:47:31
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  39  19.77M  19.77M  19.77M  19.77M  19.77M       0  19.77M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G

# Query 11: 301.93 QPS, 0.10x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 171233925
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   20531
# Exec time      1      7s    38us   128ms   323us     1ms     2ms    76us
# Lock time      4   103ms       0    24ms     5us     1us   187us     1us
# Rows sent      0  20.05k       1       1       1       1       0       1
# Rows examine   0  20.05k       1       1       1       1       0       1
# Query size     3   1.99M     101     102  101.85   97.36       0   97.36
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ###################
#   1ms  ####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '10345'\G

# Query 12: 169.34 QPS, 0.07x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 178812636
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2022-06-11T07:47:37 to 2022-06-11T07:48:44
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1   11346
# Exec time      1      5s    75us    40ms   429us     2ms     1ms   125us
# Lock time      1    38ms       0     4ms     3us     1us    58us     1us
# Rows sent      0  11.08k       1       1       1       1       0       1
# Rows examine   0  11.08k       1       1       1       1       0       1
# Query size     1 686.96k      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y8750NP3RF8NV2AH89J710'\G
