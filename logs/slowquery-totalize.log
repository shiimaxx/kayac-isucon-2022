
# 24.1s user time, 10ms system time, 31.32M rss, 39.41M vsz
# Current date: Sun Jun 12 00:59:14 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 422.60k total, 38 unique, 10.04 QPS, 0.01x concurrency ________
# Time range: 2022-06-11T13:17:42 to 2022-06-12T00:59:06
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           281s     1us      7s   664us     2ms    12ms   103us
# Lock time             2s       0    57ms     5us     1us   222us     1us
# Rows sent          2.08M       0 252.70k    5.16   22.53  386.60    0.99
# Rows examine      46.73M       0  19.76M  115.96   69.19  31.07k       0
# Query size        48.21M       6   1.68k  119.62  284.79  115.00  107.34

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0xD3D79AC2E339745D16FD77E... 77.2800 27.5% 222714 0.0003  0.01 SELECT playlist_favorite
#    2 0xA6F5EBC08FC0B14AC6764BC... 59.5827 21.2%   3397 0.0175  0.02 SELECT playlist user playlist_song
#    3 0xFE201CF788CDAF0ED135116... 35.6713 12.7%  85422 0.0004  0.01 SELECT user
#    4 0x0C7853719E9897E59B57F2A... 27.0476  9.6%  18537 0.0015  0.01 SELECT playlist_song song artist
#    5 0xEAB3DED3FE9C0C2118DCE94... 20.3883  7.3%   3665 0.0056  0.01 SELECT playlist user
#    6 0xE4CA4C0AA0D305F63D77C03...  9.1526  3.3%  23574 0.0004  0.01 SELECT sessions_golang
#    7 0x3B7F9C3BFD4303564EFFC05...  9.0842  3.2%  14296 0.0006  0.01 INSERT playlist_favorite
#    8 0xA1D549827369435D2D6B8F3...  8.1399  2.9%   1101 0.0074  0.01 SELECT playlist_favorite playlist user
#    9 0x0A24D4A57D22B71F538F1AE...  7.8473  2.8%  14685 0.0005  0.01 SELECT song
#   10 0xBB803527F0B05ED37FAF2BB...  6.8627  2.4%      1 6.8627  0.00 DELETE SELECT playlist_song playlist
#   11 0x9FEFFEE564795B4341138AC...  5.6765  2.0%  14514 0.0004  0.01 SELECT playlist_favorite
# MISC 0xMISC                       13.9983  5.0%  20698 0.0007   0.0 <27 ITEMS>

# Query 1: 3.28k QPS, 1.14x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 135938776
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         52  222714
# Exec time     27     77s    41us   119ms   346us     1ms     1ms    93us
# Lock time     44   996ms       0    31ms     4us     1us   144us     1us
# Rows sent     10 217.49k       1       1       1       1       0       1
# Rows examine   0  14.30k       0       1    0.07    0.99    0.25       0
# Query size    50  24.50M     103     134  115.37  124.25    6.52  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ###################################################
#   1ms  ######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'fastreallymanager' AND playlist_id = 0\G

# Query 2: 49.96 QPS, 0.88x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 117934979
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    3397
# Exec time     21     60s     2ms   181ms    18ms    51ms    17ms    11ms
# Lock time      0    18ms     1us     5ms     5us     2us    96us     1us
# Rows sent     18 401.40k     121     121     121     121       0     121
# Rows examine  37  17.60M   5.31k   5.31k   5.31k   5.31k       0   5.31k
# Query size     8   3.98M   1.20k   1.20k   1.20k   1.20k       0   1.20k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ############################################
#  10ms  ################################################################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (90348, 115815, 253434, 170624, 153021, 70348, 133021, 44, 329941, 281490, 271490, 20044, 10044, 207804, 233434, 310914, 30044, 143021, 105815, 80348/*... omitted 101 items ...*/) GROUP BY p.id\G

# Query 3: 1.26k QPS, 0.52x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 72164945
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         20   85422
# Exec time     12     36s    46us    90ms   417us     2ms     2ms    98us
# Lock time     13   301ms       0    17ms     3us     1us    91us     1us
# Rows sent      3  83.42k       1       1       1       1       0       1
# Rows examine   0  83.42k       1       1       1       1       0       1
# Query size     9   4.52M      47      70   55.50   59.77    3.65   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #########################################################
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'impactoldher'\G

# Query 4: 272.60 QPS, 0.40x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 79070657
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   18537
# Exec time      9     27s   108us    57ms     1ms     6ms     3ms   467us
# Lock time      6   137ms     1us    13ms     7us     2us   163us     1us
# Rows sent     33 722.21k       0      79   39.90   72.65   22.93   38.53
# Rows examine   4   2.12M       0     237  119.69  223.14   68.75  118.34
# Query size    10   5.04M     280     285  284.88  284.79    2.50  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ######################
#  10ms  ##
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 366719\G

# Query 5: 53.90 QPS, 0.30x concurrency, ID 0xEAB3DED3FE9C0C2118DCE9446258D799 at byte 132484324
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    3665
# Exec time      7     20s   498us    91ms     6ms    20ms     8ms     3ms
# Lock time      0    21ms     1us     8ms     5us     1us   144us     1us
# Rows sent     16 357.91k     100     100     100     100       0     100
# Rows examine   1 783.77k     200     316  218.98  271.23   24.22  202.40
# Query size     2   1.35M     385     385     385     385       0     385
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ########
#   1ms  ################################################################
#  10ms  #############
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (ulid) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.ulid DESC LIMIT 100\G

# Query 6: 346.68 QPS, 0.13x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 47595202
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5   23574
# Exec time      3      9s    35us    54ms   388us     1ms     2ms    80us
# Lock time      2    58ms       0     5ms     2us     1us    42us     1us
# Rows sent      1  23.02k       1       1       1       1       0       1
# Rows examine   0  23.02k       1       1       1       1       0       1
# Query size     4   2.29M     102     102     102     102       0     102
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ###########################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '18046'\G

# Query 7: 210.24 QPS, 0.13x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 105652387
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   14296
# Exec time      3      9s    68us    61ms   635us     3ms     2ms   125us
# Lock time      2    49ms       0     5ms     3us     1us    56us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     4   2.10M     145     168  153.68  158.58    4.49  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (366776, 'reduceoncewriter', '2022-06-11 13:18:51.418516847')\G

# Query 8: 16.19 QPS, 0.12x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 128239491
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1101
# Exec time      2      8s   205us   117ms     7ms    24ms    10ms     4ms
# Lock time      0     3ms     1us     1ms     3us     1us    32us     1us
# Rows sent      2  47.75k       0      86   44.41   56.92    8.44   42.48
# Rows examine   0 289.26k       0     483  269.03  329.68   43.97  258.32
# Query size     1 517.79k     474     496  481.57  463.90    4.88  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  ###################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'interestanswerinterview' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 9: 215.96 QPS, 0.12x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 87062292
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   14685
# Exec time      2      8s    76us    58ms   534us     2ms     2ms   138us
# Lock time      5   117ms       0    57ms     7us     1us   467us     1us
# Rows sent      0  14.34k       1       1       1       1       0       1
# Rows examine   0  14.34k       1       1       1       1       0       1
# Query size     1 889.13k      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y874P4TKT7BVMS58M1BG83'\G

# Query 10: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2342
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-11T13:17:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      2      7s      7s      7s      7s      7s       0      7s
# Lock time      0     7us     7us     7us     7us     7us       0     7us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  42  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G

# Query 11: 213.44 QPS, 0.08x concurrency, ID 0x9FEFFEE564795B4341138ACE04ABE55B at byte 79052089
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T13:17:59 to 2022-06-11T13:19:07
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   14514
# Exec time      2      6s    53us    52ms   391us     1ms     2ms    98us
# Lock time      2    61ms       0     8ms     4us     1us    93us     1us
# Rows sent      0     215       0       1    0.01       0    0.12       0
# Rows examine   0     215       0       1    0.01       0    0.12       0
# Query size     3   1.52M     101     124  109.78  112.70    3.81  107.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##########################################################
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist_favorite WHERE `playlist_id` = 366682 AND `favorite_user_account` = 'seatchangespring'\G
