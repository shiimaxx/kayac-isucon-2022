
# 28.5s user time, 50ms system time, 31.28M rss, 39.24M vsz
# Current date: Sat Jun 11 08:58:10 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 506.83k total, 38 unique, 3.38k QPS, 2.60x concurrency ________
# Time range: 2022-06-11T08:55:28 to 2022-06-11T08:57:58
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           389s     1us      7s   768us     2ms    11ms   113us
# Lock time             2s       0    65ms     4us     1us   210us     1us
# Rows sent          2.01M       0 252.73k    4.16    0.99  353.08    0.99
# Rows examine      48.38M       0  19.77M  100.10    0.99  28.40k    0.99
# Query size        53.40M       6   1.80k  110.47  151.03  128.30  102.22

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0xD3D79AC2E339745D16FD77E... 85.3345 21.9% 232033 0.0004  0.01 SELECT playlist_favorite
#    2 0xA6F5EBC08FC0B14AC6764BC... 85.0419 21.8%   2268 0.0375  0.03 SELECT playlist user playlist_song
#    3 0xEF4E32253D50FC6205E21CE... 64.9578 16.7% 110203 0.0006  0.01 SELECT playlist
#    4 0x0C7853719E9897E59B57F2A... 37.4795  9.6%  16193 0.0023  0.01 SELECT playlist_song song artist
#    5 0xFE201CF788CDAF0ED135116... 30.1414  7.7%  71215 0.0004  0.01 SELECT user
#    6 0xA1D549827369435D2D6B8F3... 17.2850  4.4%   1030 0.0168  0.04 SELECT playlist_favorite playlist user
#    7 0x740EF2FBF5412A2DE51CEA9... 17.0311  4.4%   2499 0.0068  0.02 SELECT playlist user
#    8 0x3B7F9C3BFD4303564EFFC05... 10.5467  2.7%  12376 0.0009  0.01 INSERT playlist_favorite
#    9 0xE4CA4C0AA0D305F63D77C03...  8.5224  2.2%  20843 0.0004  0.01 SELECT sessions_golang
#   10 0x0A24D4A57D22B71F538F1AE...  7.5091  1.9%  13649 0.0006  0.01 SELECT song
#   11 0xBB803527F0B05ED37FAF2BB...  6.6131  1.7%      1 6.6131  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                       18.9882  4.9%  24518 0.0008   0.0 <27 ITEMS>

# Query 1: 3.41k QPS, 1.25x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 123702654
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         45  232033
# Exec time     21     85s    40us   100ms   367us     1ms     2ms    93us
# Lock time     37   889ms       0    16ms     3us     1us    98us     1us
# Rows sent     11 226.59k       1       1       1       1       0       1
# Rows examine   0  32.68k       0       1    0.14    0.99    0.35       0
# Query size    48  25.74M     103     134  116.34  124.25    6.34  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ###############################################
#   1ms  ######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'recentlyseatreatment' AND playlist_id = 16627\G

# Query 2: 33.35 QPS, 1.25x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 126558319
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.03
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2268
# Exec time     21     85s     4ms   251ms    37ms   105ms    33ms    26ms
# Lock time      0    10ms     1us     2ms     4us     2us    50us     1us
# Rows sent     21 445.07k     177     201  200.95  192.76    0.84  192.76
# Rows examine  40  19.70M   7.73k   8.90k   8.89k   8.89k   58.10   8.89k
# Query size     7   3.99M   1.80k   1.80k   1.80k   1.80k       0   1.80k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ##########
#  10ms  ################################################################
# 100ms  #####
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (90348, 180624, 105815, 80348, 217804, 207804, 300914, 30044, 310914, 197804, 253434, 233434, 143021, 170624, 339941, 115815, 153021, 70348, 133021, 44/*... omitted 181 items ...*/) GROUP BY p.id\G

# Query 3: 1.62k QPS, 0.96x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 123686463
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         21  110203
# Exec time     16     65s    74us    99ms   589us     2ms     2ms   138us
# Lock time     18   429ms       0    23ms     3us     1us   128us     1us
# Rows sent      5 107.62k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0 107.62k       0       1    1.00    0.99    0.00    0.99
# Query size    12   6.94M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01G58ZNCP10Y0FEDJSQ278XP5F'\G

# Query 4: 238.13 QPS, 0.55x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 129001345
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   16193
# Exec time      9     37s   111us   135ms     2ms    10ms     6ms   626us
# Lock time      2    71ms     1us     7ms     4us     2us    69us     1us
# Rows sent     30 626.42k       0      79   39.61   72.65   23.26   38.53
# Rows examine   3   1.84M       0     237  118.84  223.14   69.89  118.34
# Query size     8   4.40M     281     285  284.86  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ################################
#  10ms  #####
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 300914\G

# Query 5: 1.05k QPS, 0.44x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 141000641
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         14   71215
# Exec time      7     30s    46us   104ms   423us     2ms     2ms    98us
# Lock time     10   261ms       0    20ms     3us     1us   108us     1us
# Rows sent      3  69.55k       1       1       1       1       0       1
# Rows examine   0  69.55k       1       1       1       1       0       1
# Query size     7   3.77M      46      72   55.52   59.77    3.70   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #######################################################
#   1ms  ########
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'nowwethough'\G

# Query 6: 15.15 QPS, 0.25x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 111124260
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.04
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1030
# Exec time      4     17s   210us   212ms    17ms    61ms    24ms     7ms
# Lock time      0     3ms     1us   589us     3us     1us    23us     1us
# Rows sent      2  44.80k       0      82   44.54   56.92    7.87   42.48
# Rows examine   0 271.44k       0     514  269.86  329.68   41.39  258.32
# Query size     0 484.45k     474     496  481.63  487.09    5.39  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  #############################################
# 100ms  ###
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'significanthimcurrent' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 7: 36.75 QPS, 0.25x concurrency, ID 0x740EF2FBF5412A2DE51CEA9BD27430E7 at byte 149096494
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2499
# Exec time      4     17s   597us   131ms     7ms    26ms    10ms     3ms
# Lock time      0     8ms     1us     3ms     3us     1us    52us     1us
# Rows sent     11 244.04k     100     100     100     100       0     100
# Rows examine   0 492.96k     200     214  202.00  202.40    4.19  192.76
# Query size     1 1015.22k     416     416     416     416       0     416
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ####
#   1ms  ################################################################
#  10ms  ################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (idx_is_public_created_at_desc) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.created_at DESC LIMIT 100\G

# Query 8: 182 QPS, 0.16x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 149087551
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   12376
# Exec time      2     11s    65us    98ms   852us     3ms     3ms   125us
# Lock time      1    32ms       0     3ms     2us     1us    41us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3   1.82M     144     168  153.93  158.58    4.34  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (362995, 'protecthighdescribe', '2022-06-11 08:56:46.366660607')\G

# Query 9: 306.51 QPS, 0.13x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 128960638
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   20843
# Exec time      2      9s    41us   102ms   408us     1ms     2ms    80us
# Lock time      3    79ms       0    13ms     3us     1us   112us     1us
# Rows sent      0  20.35k       1       1       1       1       0       1
# Rows examine   0  20.35k       1       1       1       1       0       1
# Query size     3   2.03M     102     102     102     102       0     102
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #########################
#   1ms  #####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '12217'\G

# Query 10: 200.72 QPS, 0.11x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 130780495
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:55:45 to 2022-06-11T08:56:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   13649
# Exec time      1      8s    76us    53ms   550us     2ms     2ms   131us
# Lock time      5   139ms       0    42ms    10us     1us   442us     1us
# Rows sent      0  13.33k       1       1       1       1       0       1
# Rows examine   0  13.33k       1       1       1       1       0       1
# Query size     1 826.40k      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y874XXDGK912TK1NZ2AMZ3'\G

# Query 11: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2342
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-11T08:55:39
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     7us     7us     7us     7us     7us       0     7us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  40  19.77M  19.77M  19.77M  19.77M  19.77M       0  19.77M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
