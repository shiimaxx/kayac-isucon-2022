
# 20s user time, 20ms system time, 31.26M rss, 39.15M vsz
# Current date: Sun Jun 12 02:07:05 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 343.57k total, 38 unique, 476.51 QPS, 0.37x concurrency _______
# Time range: 2022-06-12T01:54:41 to 2022-06-12T02:06:42
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           269s     1us      7s   782us     3ms    14ms   108us
# Lock time             2s       0    54ms     4us     1us   175us     1us
# Rows sent          2.08M       0 252.69k    6.36   42.48  428.78    0.99
# Rows examine      47.69M       0  19.76M  145.56  136.99  34.46k    0.99
# Query size        40.34M       6   1.68k  123.13  284.79  131.11  112.70

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0xA6F5EBC08FC0B14AC6764BC... 64.5152 24.0%   3511 0.0184  0.02 SELECT playlist user playlist_song
#    2 0xD3D79AC2E339745D16FD77E... 43.6842 16.2% 125458 0.0003  0.01 SELECT playlist_favorite
#    3 0xFE201CF788CDAF0ED135116... 39.5799 14.7%  90691 0.0004  0.01 SELECT user
#    4 0x0C7853719E9897E59B57F2A... 29.0744 10.8%  20815 0.0014  0.01 SELECT playlist_song song artist
#    5 0xEAB3DED3FE9C0C2118DCE94... 21.3808  7.9%   3792 0.0056  0.01 SELECT playlist user
#    6 0x3B7F9C3BFD4303564EFFC05... 11.8904  4.4%  15353 0.0008  0.01 INSERT playlist_favorite
#    7 0xE4CA4C0AA0D305F63D77C03... 11.4824  4.3%  27324 0.0004  0.01 SELECT sessions_golang
#    8 0xA1D549827369435D2D6B8F3... 10.4722  3.9%   1459 0.0072  0.01 SELECT playlist_favorite playlist user
#    9 0x0A24D4A57D22B71F538F1AE...  8.8391  3.3%  17856 0.0005  0.01 SELECT song
#   10 0xBB803527F0B05ED37FAF2BB...  7.0553  2.6%      1 7.0553  0.00 DELETE SELECT playlist_song playlist
#   11 0x9FEFFEE564795B4341138AC...  5.4445  2.0%  15655 0.0003  0.01 SELECT playlist_favorite
#   12 0x7AB57DAE0FB77B087E0D134...  3.7745  1.4%      1 3.7745  0.00 DELETE SELECT playlist_favorite playlist
# MISC 0xMISC                       11.8089  4.4%  21650 0.0005   0.0 <26 ITEMS>

# Query 1: 51.63 QPS, 0.95x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 100619699
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    3511
# Exec time     23     65s     2ms   168ms    18ms    56ms    18ms    12ms
# Lock time      2    43ms     1us    23ms    12us     2us   381us     1us
# Rows sent     19 414.87k     121     121     121     121       0     121
# Rows examine  38  18.31M   5.34k   5.34k   5.34k   5.34k       0   5.34k
# Query size    10   4.11M   1.20k   1.20k   1.20k   1.20k       0   1.20k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  #########################################
#  10ms  ################################################################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (115815, 153021, 70348, 133021, 90348, 44, 329941, 281490, 271490, 20044, 10044, 233434, 197804, 310914, 170624, 253434, 80348, 300914, 243434, 180624/*... omitted 101 items ...*/) GROUP BY p.id\G

# Query 2: 1.84k QPS, 0.64x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 109515767
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         36  125458
# Exec time     16     44s    41us    78ms   348us     1ms     1ms    98us
# Lock time     33   561ms       0    54ms     4us     1us   194us     1us
# Rows sent      5 122.52k       1       1       1       1       0       1
# Rows examine   0  11.61k       0       1    0.09    0.99    0.29       0
# Query size    35  14.29M     103     134  119.43  124.25    3.98  118.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###############################################################
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'outsidepapertop' AND playlist_id = 197804\G

# Query 3: 1.33k QPS, 0.58x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 108605636
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         26   90691
# Exec time     14     40s    45us   104ms   436us     2ms     2ms   103us
# Lock time     20   333ms       0    14ms     3us     1us    98us     1us
# Rows sent      4  88.57k       1       1       1       1       0       1
# Rows examine   0  88.57k       1       1       1       1       0       1
# Query size    11   4.80M      46      71   55.45   59.77    3.67   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###############################################
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user WHERE `account` = 'untilteacherstuff'\G

# Query 4: 306.10 QPS, 0.43x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 82426396
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   20815
# Exec time     10     29s   108us    70ms     1ms     5ms     4ms   445us
# Lock time      8   142ms     1us    20ms     6us     2us   177us     1us
# Rows sent     35 766.04k       0      79   37.69   72.65   23.42   36.69
# Rows examine   4   2.24M       0     237  113.06  223.14   70.05  107.34
# Query size    14   5.66M     281     285  284.89  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ###################
#  10ms  ##
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 303068\G

# Query 5: 55.76 QPS, 0.31x concurrency, ID 0xEAB3DED3FE9C0C2118DCE9446258D799 at byte 79212521
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    3792
# Exec time      7     21s   531us    88ms     6ms    21ms     8ms     2ms
# Lock time      0    14ms     1us     2ms     3us     1us    49us     1us
# Rows sent     17 370.31k     100     100     100     100       0     100
# Rows examine   1 800.34k     200     316  216.13  271.23   22.05  202.40
# Query size     3   1.39M     385     385     385     385       0     385
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ######
#   1ms  ################################################################
#  10ms  #############
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (ulid) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.ulid DESC LIMIT 100\G

# Query 6: 225.78 QPS, 0.17x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 89929153
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   15353
# Exec time      4     12s    61us    76ms   774us     3ms     3ms   131us
# Lock time      3    52ms       0     5ms     3us     1us    63us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     5   2.25M     143     168  153.78  158.58    4.48  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (368190, 'waysuccessfulattention', '2022-06-12 01:55:51.832746593')\G

# Query 7: 401.82 QPS, 0.17x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 85287965
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          7   27324
# Exec time      4     11s    39us    84ms   420us     1ms     2ms    84us
# Lock time      4    70ms       0     3ms     2us     1us    33us     1us
# Rows sent      1  26.68k       1       1       1       1       0       1
# Rows examine   0  26.68k       1       1       1       1       0       1
# Query size     6   2.66M     102     102     102     102       0     102
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #############################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '20366'\G

# Query 8: 21.46 QPS, 0.15x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 100610382
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1459
# Exec time      3     10s   208us   122ms     7ms    23ms    10ms     4ms
# Lock time      0     5ms     1us   533us     3us     2us    20us     1us
# Rows sent      2  63.18k       0      91   44.34   54.21    7.86   42.48
# Rows examine   0 382.54k       0     532  268.48  329.68   40.34  258.32
# Query size     1 685.99k     472     496  481.47  487.09    5.31  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  ###############
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'seethreenecessary' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 9: 270.55 QPS, 0.13x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 47135411
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:59 to 2022-06-12T01:56:05
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5   17856
# Exec time      3      9s    76us    62ms   495us     2ms     2ms   138us
# Lock time      4    72ms       0    10ms     4us     1us   106us     1us
# Rows sent      0  17.44k       1       1       1       1       0       1
# Rows examine   0  17.44k       1       1       1       1       0       1
# Query size     2   1.06M      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y8759JJB3JBZ02E21KPRXH'\G

# Query 10: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2356
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-12T01:54:53
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      2      7s      7s      7s      7s      7s       0      7s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  41  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G

# Query 11: 230.22 QPS, 0.08x concurrency, ID 0x9FEFFEE564795B4341138ACE04ABE55B at byte 112187801
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-12T01:54:58 to 2022-06-12T01:56:06
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   15655
# Exec time      2      5s    53us    39ms   347us   972us     1ms   103us
# Lock time      3    62ms       0    10ms     3us     1us    93us     1us
# Rows sent      0     298       0       1    0.02       0    0.14       0
# Rows examine   0     298       0       1    0.02       0    0.14       0
# Query size     4   1.64M      99     124  109.88  112.70    3.78  107.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###########################################
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist_favorite WHERE `playlist_id` = 338454 AND `favorite_user_account` = 'methodcreateterm'\G

# Query 12: 0 QPS, 0x concurrency, ID 0x7AB57DAE0FB77B087E0D1340C39A97AD at byte 2662
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-12T01:54:57
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      4s      4s      4s      4s      4s       0      4s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   5   2.74M   2.74M   2.74M   2.74M   2.74M       0   2.74M
# Query size     0     122     122     122     122     122       0     122
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_favorite WHERE playlist_id NOT IN (SELECT id FROM playlist) OR '2022-05-13 09:00:00.000' < created_at\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_favorite WHERE playlist_id NOT IN (SELECT id FROM playlist) OR '2022-05-13 09:00:00.000' < created_at\G
