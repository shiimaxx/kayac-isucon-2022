
# 21.7s user time, 40ms system time, 31.19M rss, 39.29M vsz
# Current date: Sun Jun  5 10:24:38 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 405.45k total, 43 unique, 3.38k QPS, 4.82x concurrency ________
# Time range: 2022-06-05T10:22:15 to 2022-06-05T10:24:15
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           578s     2us     10s     1ms     1ms    77ms   125us
# Lock time             2s       0   163ms     4us     1us   433us     1us
# Rows sent        557.12k       0     114    1.41    0.99    5.20    0.99
# Rows examine     195.64M       0  19.76M  505.97   62.76  38.39k    0.99
# Query size        20.41M       6     417   52.79  112.70   27.30   34.95

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0x2C9AD785FB3D98E219BE1B0... 395.0636 68.3%     73 5.4118  0.78 SELECT playlist_favorite playlist user
#    2 0xEC063962A0903583D4BF22B...  46.1417  8.0%  40034 0.0012  0.01 SELECT playlist_favorite
#    3 0xCFDD294F672FC7ED341FAC0...  42.0069  7.3% 118033 0.0004  0.00 SELECT song
#    4 0x75F43F95B7E689606BBB5B7...  23.2596  4.0% 118033 0.0002  0.00 SELECT artist
#    5 0x8AFB70E4EF33ECB86281555...  13.1733  2.3%  37112 0.0004  0.00 SELECT playlist_song
#    6 0x3B7F9C3BFD4303564EFFC05...   9.7866  1.7%   1436 0.0068  0.00 INSERT playlist_favorite
#    7 0xFF9A94BDE38FB778640C906...   8.1346  1.4%  18670 0.0004  0.00 SELECT playlist
#    8 0xD3D79AC2E339745D16FD77E...   7.5701  1.3%  29934 0.0003  0.00 SELECT playlist_favorite
#    9 0xBB803527F0B05ED37FAF2BB...   7.1391  1.2%      1 7.1391  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                        25.8069  4.5%  42124 0.0006   0.0 <34 ITEMS>

# Query 1: 1.01 QPS, 5.49x concurrency, ID 0x2C9AD785FB3D98E219BE1B0CAF399758 at byte 111970711
# Scores: V/M = 0.78
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      73
# Exec time     68    395s      1s     10s      5s      8s      2s      6s
# Lock time      0   133us     1us     3us     1us     1us       0     1us
# Rows sent      1   7.13k     100     100     100     100       0     100
# Rows examine  60 118.25M   1.62M   1.62M   1.62M   1.61M       0   1.61M
# Query size     0  22.31k     313     313     313     313       0     313
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+  #
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT playlist_id, count(*) AS favorite_count FROM playlist_favorite AS pf INNER JOIN playlist AS p FORCE INDEX (is_public_user_account) ON pf.playlist_id = p.id INNER JOIN user AS u ON p.user_account = u.account WHERE p.is_public = true AND u.is_ban = false GROUP BY playlist_id ORDER BY count(*) DESC LIMIT 100\G

# Query 2: 580.20 QPS, 0.67x concurrency, ID 0xEC063962A0903583D4BF22B4F6620A35 at byte 107673250
# Scores: V/M = 0.01
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   40034
# Exec time      7     46s    67us   108ms     1ms     5ms     3ms   185us
# Lock time      4    81ms       0     3ms     2us     1us    31us     1us
# Rows sent      7  39.10k       1       1       1       1       0       1
# Rows examine  26  52.66M       0  14.65k   1.35k  14.47k   3.46k    6.98
# Query size    13   2.74M      69      72   71.84   69.19    0.05   69.19
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #########
# 100us  ################################################################
#   1ms  ##############
#  10ms  ##
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where playlist_id = 80348\G

# Query 3: 1.71k QPS, 0.61x concurrency, ID 0xCFDD294F672FC7ED341FAC0294AB364A at byte 105789260
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         29  118033
# Exec time      7     42s    44us    51ms   355us   925us     1ms   131us
# Lock time     12   235ms       0     4ms     1us     1us    27us     1us
# Rows sent     20 115.27k       1       1       1       1       0       1
# Rows examine   0 115.27k       1       1       1       1       0       1
# Query size    19   4.04M      32      36   35.85   34.95    0.25   34.95
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #################################
# 100us  ################################################################
#   1ms  ####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE id = 622940\G

# Query 4: 1.71k QPS, 0.34x concurrency, ID 0x75F43F95B7E689606BBB5B7D6427CFC1 at byte 69473019
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         29  118033
# Exec time      4     23s    40us    42ms   197us   515us   491us    98us
# Lock time     12   234ms       0     7ms     1us     1us    33us     1us
# Rows sent     20 115.27k       1       1       1       1       0       1
# Rows examine   0 115.27k       1       1       1       1       0       1
# Query size    19   4.01M      33      36   35.63   34.95    0.35   34.95
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###############################################################
# 100us  ################################################################
#   1ms  ##
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM artist WHERE id = 538\G

# Query 5: 537.86 QPS, 0.19x concurrency, ID 0x8AFB70E4EF33ECB862815558CB07356A at byte 107684664
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   37112
# Exec time      2     13s    72us    70ms   354us   925us     1ms   144us
# Lock time      4    81ms       0     5ms     2us     1us    41us     1us
# Rows sent      6  36.24k       1       1       1       1       0       1
# Rows examine   0   1.49M       0      79   41.99   72.65   21.88   42.48
# Query size    11   2.40M      65      68   67.84   65.89    0.05   65.89
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ###
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_song where playlist_id = 170624\G

# Query 6: 20.81 QPS, 0.14x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 109634764
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1436
# Exec time      1     10s     2ms    83ms     7ms    15ms     5ms     5ms
# Lock time      0     2ms       0   287us     1us     1us     8us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     1 216.51k     146     168  154.39  158.58    4.06  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ################################################################
#  10ms  ##########
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (361363, 'untilmissvery', '2022-06-05 10:23:40.78277095')\G

# Query 7: 270.58 QPS, 0.12x concurrency, ID 0xFF9A94BDE38FB778640C90666343546B at byte 68611790
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   18670
# Exec time      1      8s    57us    45ms   435us     1ms     1ms   125us
# Lock time      2    43ms       0     4ms     2us     1us    34us     1us
# Rows sent      3  18.23k       1       1       1       1       0       1
# Rows examine   0  18.23k       1       1       1       1       0       1
# Query size     3 760.72k      38      42   41.72   40.45    0.41   40.45
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #############################
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `id` = 176364\G

# Query 8: 433.83 QPS, 0.11x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 91592246
# Scores: V/M = 0.00
# Time range: 2022-06-05T10:22:33 to 2022-06-05T10:23:42
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          7   29934
# Exec time      1      8s    55us    28ms   252us   657us   740us   108us
# Lock time      4    86ms       0    19ms     2us     1us   111us     1us
# Rows sent      5  29.23k       1       1       1       1       0       1
# Rows examine   0   8.36k       0       1    0.29    0.99    0.45       0
# Query size    16   3.41M     103     134  119.31  124.25    4.80  118.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ########################################
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'chanceputso' AND playlist_id = 361332\G

# Query 9: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2363
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-05T10:22:27
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     7us     7us     7us     7us     7us       0     7us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  10  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
