
# 23s user time, 40ms system time, 31.12M rss, 39.28M vsz
# Current date: Sun Jun  5 11:52:07 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 422.44k total, 41 unique, 3.52k QPS, 4.87x concurrency ________
# Time range: 2022-06-05T11:50:02 to 2022-06-05T11:52:02
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           585s     1us      7s     1ms     1ms    66ms   108us
# Lock time             2s       0   299ms     4us     1us   637us     1us
# Rows sent         25.01M       0 252.82k   62.07    0.99   3.75k    0.99
# Rows examine     342.41M       0  19.76M  849.92   54.21  54.83k    0.99
# Query size        24.93M       6     417   61.88  151.03   56.30   34.95

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0x4FFEDD9537D4E9B44DEB7A2... 401.0309 68.6%    100 4.0103  0.63 SELECT playlist_favorite
#    2 0xCFDD294F672FC7ED341FAC0...  55.3886  9.5% 134648 0.0004  0.01 SELECT song
#    3 0x75F43F95B7E689606BBB5B7...  27.9041  4.8% 134643 0.0002  0.00 SELECT artist
#    4 0xEC063962A0903583D4BF22B...  20.9858  3.6%  30351 0.0007  0.01 SELECT playlist_favorite
#    5 0x3B7F9C3BFD4303564EFFC05...  14.9708  2.6%   2019 0.0074  0.00 INSERT playlist_favorite
#    6 0x8AFB70E4EF33ECB86281555...  10.5538  1.8%  26936 0.0004  0.01 SELECT playlist_song
#    7 0x40BA718A3112C61FB0C2179...  10.2494  1.8%  19738 0.0005  0.00 SELECT playlist user playlist_song
#    8 0xD3D79AC2E339745D16FD77E...   7.3657  1.3%  30364 0.0002  0.00 SELECT playlist_favorite
#    9 0xBB803527F0B05ED37FAF2BB...   7.1526  1.2%      1 7.1526  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                        28.9495  5.0%  43637 0.0007   0.0 <32 ITEMS>

# Query 1: 1.45 QPS, 5.81x concurrency, ID 0x4FFEDD9537D4E9B44DEB7A24247FE1ED at byte 82255012
# Scores: V/M = 0.63
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     100
# Exec time     68    401s   661ms      7s      4s      6s      2s      4s
# Lock time      0    94us       0     2us       0     1us       0     1us
# Rows sent     97  24.44M   2.14k 252.82k 250.29k 245.21k  24.19k 245.21k
# Rows examine  87 299.05M   2.75M   2.99M   2.99M   2.88M  13.99k   2.88M
# Query size     0  11.04k     113     113     113     113       0     113
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms  ###
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT playlist_id, count(*) AS favorite_count FROM playlist_favorite GROUP BY playlist_id ORDER BY count(*) DESC\G

# Query 2: 1.95k QPS, 0.80x concurrency, ID 0xCFDD294F672FC7ED341FAC0294AB364A at byte 113558254
# Scores: V/M = 0.01
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         31  134648
# Exec time      9     55s    42us    68ms   411us     1ms     2ms   103us
# Lock time     15   298ms       0    14ms     2us     1us    65us     1us
# Rows sent      0 131.49k       1       1       1       1       0       1
# Rows examine   0 131.49k       1       1       1       1       0       1
# Query size    18   4.60M      32      36   35.85   34.95    0.26   34.95
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ######################################################
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE id = 611427\G

# Query 3: 1.95k QPS, 0.40x concurrency, ID 0x75F43F95B7E689606BBB5B7D6427CFC1 at byte 44429209
# Scores: V/M = 0.00
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         31  134643
# Exec time      4     28s    36us    34ms   207us   596us   607us    84us
# Lock time     14   275ms       0     7ms     2us     1us    37us     1us
# Rows sent      0 131.49k       1       1       1       1       0       1
# Rows examine   0 131.49k       1       1       1       1       0       1
# Query size    18   4.58M      33      36   35.63   34.95    0.34   34.95
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #######################################
#   1ms  ##
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM artist WHERE id = 2559\G

# Query 4: 439.87 QPS, 0.30x concurrency, ID 0xEC063962A0903583D4BF22B4F6620A35 at byte 42727477
# Scores: V/M = 0.01
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          7   30351
# Exec time      3     21s    70us    65ms   691us     3ms     2ms   125us
# Lock time      3    64ms       0     4ms     2us     1us    35us     1us
# Rows sent      0  29.64k       1       1       1       1       0       1
# Rows examine   5  18.25M       0  14.66k  630.57   4.27k   2.57k    6.98
# Query size     8   2.08M      69      72   71.83   69.19    0.07   69.19
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #############
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where playlist_id = 217804\G

# Query 5: 29.26 QPS, 0.22x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 78111566
# Scores: V/M = 0.00
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2019
# Exec time      2     15s     2ms    93ms     7ms    17ms     6ms     5ms
# Lock time      0     3ms       0   766us     1us     1us    17us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     1 303.53k     144     168  153.95  158.58    5.04  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ################################################################
#  10ms  ##############
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (361524, 'bodycareprove', '2022-06-05 11:51:06.32481939')\G

# Query 6: 408.12 QPS, 0.16x concurrency, ID 0x8AFB70E4EF33ECB862815558CB07356A at byte 77613173
# Scores: V/M = 0.01
# Time range: 2022-06-05T11:50:20 to 2022-06-05T11:51:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   26936
# Exec time      1     11s    68us    58ms   391us     1ms     2ms   125us
# Lock time      2    51ms       0     6ms     1us     1us    41us     1us
# Rows sent      0  26.30k       1       1       1       1       0       1
# Rows examine   0   1.02M       0      79   39.77   72.65   22.39   40.45
# Query size     6   1.74M      65      68   67.83   65.89    0.07   65.89
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #####
# 100us  ################################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_song where playlist_id = 361476\G

# Query 7: 286.06 QPS, 0.15x concurrency, ID 0x40BA718A3112C61FB0C217930D97E29F at byte 111756146
# Scores: V/M = 0.00
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   19738
# Exec time      1     10s   120us    50ms   519us     2ms     1ms   194us
# Lock time      1    37ms       0     4ms     1us     1us    31us     1us
# Rows sent      0  19.28k       1       1       1       1       0       1
# Rows examine   0 830.52k       0      79   43.09   72.65   22.54   44.60
# Query size    21   5.38M     282     286  285.71  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` = 25784\G

# Query 8: 440.06 QPS, 0.11x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 76023988
# Scores: V/M = 0.00
# Time range: 2022-06-05T11:50:19 to 2022-06-05T11:51:28
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          7   30364
# Exec time      1      7s    52us    34ms   242us   657us   797us    98us
# Lock time      3    70ms       0    14ms     2us     1us    90us     1us
# Rows sent      0  29.65k       1       1       1       1       0       1
# Rows examine   0   7.54k       0       1    0.25    0.99    0.43       0
# Query size    13   3.44M     103     134  118.96  124.25    5.01  118.34
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #############################################################
#   1ms  ###
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'ifwithoutstart' AND playlist_id = 143021\G

# Query 9: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2342
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-05T11:50:14
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     9us     9us     9us     9us     9us       0     9us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   5  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
