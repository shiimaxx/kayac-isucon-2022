
# 35.4s user time, 60ms system time, 31.38M rss, 39.20M vsz
# Current date: Thu Jun  9 13:24:58 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 622.58k total, 38 unique, 5.23k QPS, 3.89x concurrency ________
# Time range: 2022-06-09T13:22:43 to 2022-06-09T13:24:42
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           463s     1us      7s   743us     2ms    12ms   108us
# Lock time             2s       0    84ms     3us     1us   212us     1us
# Rows sent          3.02M       0 252.74k    5.08   18.53  319.27    0.99
# Rows examine      65.53M       0  19.76M  110.37   76.28  25.64k    0.99
# Query size        65.02M       6   4.06k  109.51  284.79  194.01   65.89

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0xA6F5EBC08FC0B14AC6764BC... 158.5408 34.3%   1412 0.1123  0.07 SELECT playlist user playlist_song
#    2 0x0C7853719E9897E59B57F2A...  68.4760 14.8%  36433 0.0019  0.01 SELECT playlist_song song artist
#    3 0x8AFB70E4EF33ECB86281555...  62.7929 13.6% 194637 0.0003  0.00 SELECT playlist_song
#    4 0xD3D79AC2E339745D16FD77E...  57.0706 12.3% 197422 0.0003  0.01 SELECT playlist_favorite
#    5 0xEF4E32253D50FC6205E21CE...  35.8211  7.7%  72910 0.0005  0.01 SELECT playlist
#    6 0xFE201CF788CDAF0ED135116...  17.7600  3.8%  52373 0.0003  0.01 SELECT user
#    7 0x3B7F9C3BFD4303564EFFC05...   9.9594  2.2%  12741 0.0008  0.02 INSERT playlist_favorite
#    8 0x740EF2FBF5412A2DE51CEA9...   9.3013  2.0%   1538 0.0060  0.01 SELECT playlist user
#    9 0xA1D549827369435D2D6B8F3...   8.8529  1.9%    877 0.0101  0.02 SELECT playlist_favorite playlist user
#   10 0xE4CA4C0AA0D305F63D77C03...   7.3604  1.6%  19910 0.0004  0.01 SELECT sessions_golang
#   11 0xBB803527F0B05ED37FAF2BB...   7.0999  1.5%      1 7.0999  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                        19.8135  4.3%  32329 0.0006   0.0 <27 ITEMS>

# Query 1: 20.76 QPS, 2.33x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 203510311
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.07
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1412
# Exec time     34    159s     4ms   594ms   112ms   293ms    90ms    87ms
# Lock time      0     6ms     1us     4ms     4us     1us    96us     1us
# Rows sent     22 689.88k     177     501  500.31  487.09   14.38  487.09
# Rows examine  43  28.72M   7.26k  20.85k  20.82k  20.37k  631.97  20.37k
# Query size     8   5.60M   4.06k   4.06k   4.06k   4.06k       0   4.06k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  #
#  10ms  ################################################################
# 100ms  ######################################################
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (105815, 143021, 90348, 30044, 80348, 115815, 153021, 70348, 133021, 44, 329941, 281490, 271490, 20044, 170624, 10044, 300914, 310914, 207804, 339941/*... omitted 481 items ...*/) GROUP BY p.id\G

# Query 2: 535.78 QPS, 1.01x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 196630989
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          5   36433
# Exec time     14     68s    92us   129ms     2ms     8ms     5ms   467us
# Lock time      8   212ms       0    23ms     5us     1us   167us     1us
# Rows sent     45   1.39M       0      79   39.92   72.65   22.80   38.53
# Rows examine   6   4.16M       0     237  119.75  223.14   68.10  118.34
# Query size    15   9.89M     282     285  284.68  284.79    1.50  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######################
#  10ms  ###
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 361361\G

# Query 3: 2.86k QPS, 0.92x concurrency, ID 0x8AFB70E4EF33ECB862815558CB07356A at byte 64988924
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         31  194637
# Exec time     13     63s    58us    67ms   322us     1ms     1ms   113us
# Lock time     23   574ms       0    23ms     2us     1us    90us     1us
# Rows sent      6 190.08k       1       1       1       1       0       1
# Rows examine   9   6.18M       0      79   33.32   72.65   25.88   31.70
# Query size    19  12.43M      63      68   66.97   65.89    1.25   65.89
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ############
# 100us  ################################################################
#   1ms  ####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_song where playlist_id = 361125\G

# Query 4: 2.90k QPS, 0.84x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 197839463
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         31  197422
# Exec time     12     57s    39us   103ms   289us   881us     1ms    89us
# Lock time     28   684ms       0    82ms     3us     1us   217us     1us
# Rows sent      6 192.79k       1       1       1       1       0       1
# Rows examine   0  27.77k       0       1    0.14    0.99    0.35       0
# Query size    33  22.04M     103     134  117.04  124.25    5.73  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #################################
#   1ms  ####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'mightfollowthrow' AND playlist_id = 5199\G

# Query 5: 1.07k QPS, 0.53x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 162890108
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         11   72910
# Exec time      7     36s    73us    85ms   491us     2ms     2ms   131us
# Lock time     10   257ms       0    18ms     3us     1us    98us     1us
# Rows sent      2  71.20k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0  71.20k       0       1    1.00    0.99    0.00    0.99
# Query size     7   4.59M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01G54A593F16WJ4E6V2H54P0GD'\G

# Query 6: 770.19 QPS, 0.26x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 157958336
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          8   52373
# Exec time      3     18s    49us    93ms   339us     1ms     1ms    93us
# Lock time      7   194ms       0    26ms     3us     1us   144us     1us
# Rows sent      1  51.15k       1       1       1       1       0       1
# Rows examine   0  51.15k       1       1       1       1       0       1
# Query size     4   2.77M      47      71   55.45   59.77    3.76   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #########################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user where `account` = 'yeahhundredstudent'\G

# Query 7: 187.37 QPS, 0.15x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 178269125
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   12741
# Exec time      2     10s    65us    80ms   781us     2ms     4ms   119us
# Lock time      2    56ms       0    10ms     4us     1us   113us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     2   1.86M     144     168  153.47  158.58    4.47  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ####
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (13001, 'accordingphoneeither', '2022-06-09 13:24:00.23352411')\G

# Query 8: 22.62 QPS, 0.14x concurrency, ID 0x740EF2FBF5412A2DE51CEA9BD27430E7 at byte 171177054
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1538
# Exec time      2      9s   599us   126ms     6ms    19ms     9ms     3ms
# Lock time      0     8ms       0     2ms     5us     1us    66us     1us
# Rows sent      4 150.20k     100     100     100     100       0     100
# Rows examine   0 304.12k     200     214  202.48  202.40    4.46  192.76
# Query size     0 624.81k     416     416     416     416       0     416
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ######
#   1ms  ################################################################
#  10ms  ##############
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (idx_is_public_created_at_desc) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.created_at DESC LIMIT 100\G

# Query 9: 12.90 QPS, 0.13x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 104216750
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     877
# Exec time      1      9s   208us   145ms    10ms    33ms    13ms     5ms
# Lock time      0     2ms     1us   235us     2us     1us    10us     1us
# Rows sent      1  38.18k       0      83   44.58   54.21    7.99   42.48
# Rows examine   0 229.56k       0     509  268.04  313.99   42.30  258.32
# Query size     0 412.50k     474     496  481.65  487.09    5.43  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  ###########################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'lightstandarddrug' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 10: 292.79 QPS, 0.11x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 202292322
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-09T13:23:00 to 2022-06-09T13:24:08
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          3   19910
# Exec time      1      7s    38us   117ms   369us     1ms     2ms    76us
# Lock time      5   131ms       0    65ms     6us     1us   468us     1us
# Rows sent      0  19.44k       1       1       1       1       0       1
# Rows examine   0  19.44k       1       1       1       1       0       1
# Query size     2   1.92M     101     101     101     101       0     101
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ##################
#   1ms  ####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '9565'\G

# Query 11: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2363
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-09T13:22:55
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     7us     7us     7us     7us     7us       0     7us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  30  19.76M  19.76M  19.76M  19.76M  19.76M       0  19.76M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
