
# 29.8s user time, 60ms system time, 31.24M rss, 39.29M vsz
# Current date: Sat Jun 11 08:10:48 2022
# Hostname: ip-10-0-0-56
# Files: /home/isucon/webapp/mysql/logs/mysql-slow.log
# Overall: 520.23k total, 38 unique, 4.34k QPS, 3.31x concurrency ________
# Time range: 2022-06-11T08:08:26 to 2022-06-11T08:10:26
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           397s     1us      7s   762us     2ms    11ms   113us
# Lock time             2s       0    45ms     4us     1us   185us     1us
# Rows sent          3.17M       0 252.74k    6.39   46.83  348.62    0.99
# Rows examine      49.55M       0  19.77M   99.88  143.84  28.03k    0.99
# Query size        60.60M       6   1.80k  122.14  284.79  126.70  107.34

# Profile
# Rank Query ID                     Response time Calls  R/Call V/M   Item
# ==== ============================ ============= ====== ====== ===== ====
#    1 0x0C7853719E9897E59B57F2A... 97.5574 24.6%  47841 0.0020  0.01 SELECT playlist_song song artist
#    2 0xD3D79AC2E339745D16FD77E... 76.2287 19.2% 233210 0.0003  0.01 SELECT playlist_favorite
#    3 0xA6F5EBC08FC0B14AC6764BC... 63.2151 15.9%   1974 0.0320  0.03 SELECT playlist user playlist_song
#    4 0xEF4E32253D50FC6205E21CE... 55.5368 14.0%  95746 0.0006  0.01 SELECT playlist
#    5 0xFE201CF788CDAF0ED135116... 25.3034  6.4%  64569 0.0004  0.01 SELECT user
#    6 0x740EF2FBF5412A2DE51CEA9... 14.9704  3.8%   2167 0.0069  0.02 SELECT playlist user
#    7 0xA1D549827369435D2D6B8F3... 14.5179  3.7%   1119 0.0130  0.02 SELECT playlist_favorite playlist user
#    8 0x3B7F9C3BFD4303564EFFC05...  9.3230  2.3%  12730 0.0007  0.01 INSERT playlist_favorite
#    9 0xE4CA4C0AA0D305F63D77C03...  9.2082  2.3%  21584 0.0004  0.01 SELECT sessions_golang
#   10 0x0A24D4A57D22B71F538F1AE...  7.1058  1.8%  14971 0.0005  0.01 SELECT song
#   11 0xBB803527F0B05ED37FAF2BB...  6.6072  1.7%      1 6.6072  0.00 DELETE SELECT playlist_song playlist
# MISC 0xMISC                       17.2071  4.3%  24322 0.0007   0.0 <27 ITEMS>

# Query 1: 703.54 QPS, 1.43x concurrency, ID 0x0C7853719E9897E59B57F2AB15A3EBE3 at byte 74433751
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          9   47841
# Exec time     24     98s    99us   140ms     2ms     9ms     5ms   490us
# Lock time     11   259ms       0    11ms     5us     1us   123us     1us
# Rows sent     59   1.88M       0      79   41.14   72.65   22.77   42.48
# Rows examine  11   5.63M       0     237  123.43  223.14   68.13  124.25
# Query size    21  13.00M     281     285  284.86  284.79       2  284.79
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  #######################
#  10ms  ####
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'artist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`artist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT s.ulid `song.ulid`, s.title `song.title`, a.name `artist.name`, s.album `song.album`, s.track_number `song.track_number`, s.is_public `song.is_public` FROM playlist_song ps LEFT JOIN song s ON ps.song_id = s.id LEFT JOIN artist a ON s.artist_id = a.id WHERE playlist_id = 269143\G

# Query 2: 3.43k QPS, 1.12x concurrency, ID 0xD3D79AC2E339745D16FD77E13E6AC90F at byte 74424916
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         44  233210
# Exec time     19     76s    40us   163ms   326us     1ms     1ms    89us
# Lock time     34   811ms       0    31ms     3us     1us   135us     1us
# Rows sent      7 227.74k       1       1       1       1       0       1
# Rows examine   0  33.28k       0       1    0.15    0.99    0.35       0
# Query size    42  25.94M     103     134  116.65  124.25    6.05  112.70
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #########################################
#   1ms  #####
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) AS cnt FROM playlist_favorite where favorite_user_account = 'courseminutefather' AND playlist_id = 334130\G

# Query 3: 29.03 QPS, 0.93x concurrency, ID 0xA6F5EBC08FC0B14AC6764BC9CB69A03A at byte 179929010
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.03
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1974
# Exec time     15     63s     3ms   284ms    32ms    87ms    30ms    22ms
# Lock time      0     5ms       0   790us     2us     1us    21us     1us
# Rows sent     11 387.45k     177     201  200.99  192.76    0.40  192.76
# Rows examine  34  17.15M   7.73k   8.90k   8.90k   8.89k   27.88   8.89k
# Query size     5   3.48M   1.80k   1.80k   1.80k   1.80k       0   1.80k
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ##############
#  10ms  ################################################################
# 100ms  ###
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.display_name AS 'user.display_name', u.account AS `user.account`, u.is_ban AS `user.is_ban`, COUNT(ps.playlist_id) AS song_count FROM playlist AS p LEFT JOIN user AS u ON p.user_account = u.account LEFT JOIN playlist_song AS ps ON p.id = ps.playlist_id WHERE `id` IN (170624, 207804, 233434, 80348, 90348, 253434, 300914, 339941, 30044, 105815, 310914, 217804, 143021, 197804, 180624, 243434, 115815, 153021, 70348, 133021/*... omitted 181 items ...*/) GROUP BY p.id\G

# Query 4: 1.41k QPS, 0.82x concurrency, ID 0xEF4E32253D50FC6205E21CEE5B40F6F1 at byte 172284952
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         18   95746
# Exec time     13     56s    72us    80ms   580us     2ms     2ms   131us
# Lock time     15   370ms       0    38ms     3us     1us   145us     1us
# Rows sent      2  93.50k       0       1    1.00    0.99    0.00    0.99
# Rows examine   0  93.50k       0       1    1.00    0.99    0.00    0.99
# Query size     9   6.03M      66      66      66      66       0      66
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM playlist WHERE `ulid` = '01FD9SCSVRGVZ49E1C6TE1B007'\G

# Query 5: 949.54 QPS, 0.37x concurrency, ID 0xFE201CF788CDAF0ED13511641E92D414 at byte 173671126
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         12   64569
# Exec time      6     25s    48us   125ms   391us     1ms     2ms    93us
# Lock time     11   260ms       0    18ms     4us     1us   118us     1us
# Rows sent      1  63.06k       1       1       1       1       0       1
# Rows examine   0  63.06k       1       1       1       1       0       1
# Query size     5   3.41M      47      71   55.42   59.77    3.76   54.21
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ##############################################
#   1ms  #######
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM user where `account` = 'risereachphysical'\G

# Query 6: 31.87 QPS, 0.22x concurrency, ID 0x740EF2FBF5412A2DE51CEA9BD27430E7 at byte 123332815
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2167
# Exec time      3     15s   564us   177ms     7ms    26ms    12ms     3ms
# Lock time      0    14ms       0     7ms     6us     1us   150us     1us
# Rows sent      6 211.62k     100     100     100     100       0     100
# Rows examine   0 427.62k     200     214  202.07  202.40    4.25  192.76
# Query size     1 880.34k     416     416     416     416       0     416
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ########
#   1ms  ################################################################
#  10ms  #################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.*, u.account AS 'user.account', u.display_name AS 'user.display_name', u.password_hash AS 'user.password_hash', u.is_ban AS 'user.is_ban', u.created_at AS 'user.created_at', u.last_logined_at AS 'user.last_logined_at' FROM playlist as p FORCE INDEX (idx_is_public_created_at_desc) INNER JOIN user as u on p.user_account = u.account where p.is_public = 1 and u.is_ban = 0 ORDER BY p.created_at DESC LIMIT 100\G

# Query 7: 16.46 QPS, 0.21x concurrency, ID 0xA1D549827369435D2D6B8F3232875C93 at byte 74534202
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.02
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1119
# Exec time      3     15s   208us   204ms    13ms    46ms    17ms     7ms
# Lock time      0     5ms     1us   971us     4us     1us    42us     1us
# Rows sent      1  48.31k       0      89   44.21   54.21    7.90   42.48
# Rows examine   0 292.50k       0     535  267.67  313.99   41.70  258.32
# Query size     0 526.10k     474     496  481.44  487.09    5.10  463.90
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  ##########################################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'user'\G
#    SHOW CREATE TABLE `isucon_listen80`.`user`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT p.ulid AS `playlist.ulid`, p.name AS `playlist.name`, p.is_public AS `playlist.is_public`, p.created_at AS `playlist.created_at`, p.updated_at AS `playlist.updated_at`, u.display_name AS `user.display_name`, u.account AS `user.account` FROM playlist_favorite pf LEFT JOIN playlist p ON pf.playlist_id = p.id LEFT JOIN user u ON p.user_account = u.account WHERE favorite_user_account = 'hundredbluemanagement' AND p.is_public = true AND u.is_ban = false ORDER BY p.created_at DESC\G

# Query 8: 187.21 QPS, 0.14x concurrency, ID 0x3B7F9C3BFD4303564EFFC05B3903B6C4 at byte 144319673
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   12730
# Exec time      2      9s    57us    74ms   732us     3ms     3ms   119us
# Lock time      1    39ms       0     5ms     3us     1us    57us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3   1.87M     144     168  153.88  158.58    4.56  151.03
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ####
# 100us  ################################################################
#   1ms  #######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_favorite'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_favorite`\G
INSERT INTO playlist_favorite (`playlist_id`, `favorite_user_account`, `created_at`) VALUES (361987, 'politicsespeciallyspend', '2022-06-11 08:09:39.786556215')\G

# Query 9: 317.41 QPS, 0.14x concurrency, ID 0xE4CA4C0AA0D305F63D77C03DA6910CB2 at byte 179546250
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:51
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          4   21584
# Exec time      2      9s    37us    72ms   426us     1ms     2ms    76us
# Lock time      4    97ms       0    29ms     4us     1us   208us     1us
# Rows sent      0  21.08k       1       1       1       1       0       1
# Rows examine   0  21.08k       1       1       1       1       0       1
# Query size     3   2.10M     102     102     102     102       0     102
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  #####################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'sessions_golang'\G
#    SHOW CREATE TABLE `isucon_listen80`.`sessions_golang`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT id, session_data, created_on, modified_on, expires_on from `sessions_golang` WHERE id = '10464'\G

# Query 10: 223.45 QPS, 0.11x concurrency, ID 0x0A24D4A57D22B71F538F1AE200CFCE54 at byte 146191198
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.01
# Time range: 2022-06-11T08:08:43 to 2022-06-11T08:09:50
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2   14971
# Exec time      1      7s    71us    54ms   474us     2ms     2ms   131us
# Lock time      2    66ms       0    13ms     4us     1us   142us     1us
# Rows sent      0  14.62k       1       1       1       1       0       1
# Rows examine   0  14.62k       1       1       1       1       0       1
# Query size     1 906.45k      62      62      62      62       0      62
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`song`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT * FROM song WHERE `ulid` = '01G2Y87569RH3QX8G4ZCA3SPVD'\G

# Query 11: 0 QPS, 0x concurrency, ID 0xBB803527F0B05ED37FAF2BBD29AD2CB4 at byte 2363
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-06-11T08:08:38
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0       1
# Exec time      1      7s      7s      7s      7s      7s       0      7s
# Lock time      0     8us     8us     8us     8us     8us       0     8us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  39  19.77M  19.77M  19.77M  19.77M  19.77M       0  19.77M
# Query size     0      76      76      76      76      76       0      76
# String:
# Databases    isucon_listen80
# Hosts        webapp-app-1.webapp_default
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################################
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist_song'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist_song`\G
#    SHOW TABLE STATUS FROM `isucon_listen80` LIKE 'playlist'\G
#    SHOW CREATE TABLE `isucon_listen80`.`playlist`\G
DELETE FROM playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  playlist_song WHERE playlist_id NOT IN (SELECT id FROM playlist)\G
